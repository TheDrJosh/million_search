syntax = "proto3";
package crawler;

service Crawler {
  rpc GetJob(GetJobRequest) returns (GetJobResponse);
  rpc ReturnJob(ReturnJobRequest) returns (ReturnJobResponse);
  rpc KeepAliveJob(KeepAliveJobRequest) returns (KeepAliveJobResponse);
}

message GetJobRequest {}

message GetJobResponse {
  int32 id = 1;
  string url = 2;
}

message ReturnJobRequest {
  int32 id = 1;

  string url = 2;

  oneof result {
    Ok ok = 3;
    Err err = 4;
  }

  message Ok {
    int32 status = 3;

    string MIME_type = 4;

    repeated string linked_urls = 5;

    oneof body {
      Html html = 7;
      Image image = 8;
      Video video = 9;
      Audio audio = 10;
    }

    message Html {
      optional string title = 1;
      optional string description = 2;
      optional string icon_url = 3;

      repeated string text_fields = 4;
      repeated string sections = 5;
    }
    message Image {
      oneof data {
        BitmapImage bitmap = 1;
        VectorImage vector = 2;
      }

      message BitmapImage { bytes data = 1; }
      message VectorImage { string svg = 1; }
    }
    message Video { bytes data = 1; }
    message Audio { bytes data = 1; }
  }

  message Err {}
}

message ReturnJobResponse {}

message KeepAliveJobRequest {
  int32 id = 1;
  string url = 2;
}

message KeepAliveJobResponse {}
